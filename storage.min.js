(function(){window.storage={STORAGE_PREFIX:"storage-",VERSION:1,CONTENT_LENGTH_LIMIT:1e6,CHECK_FILE_AFTER_ACTION:!0,SAVE_CONFIG_AFTER_ACTION:!0,createFile(a,b){if(!this._checkTypes([a,b],["string","string"]))throw`Invalid input variables`;if(b.length>this.CONTENT_LENGTH_LIMIT)throw`File content length must be less ${this.CONTENT_LENGTH_LIMIT}`;if(-1!==this._storage.indexes.indexOf(a))throw`File with name "${a}" is already exists`;if(localStorage.setItem(this.STORAGE_PREFIX+a,b),this.CHECK_FILE_AFTER_ACTION&&null===localStorage.getItem(this.STORAGE_PREFIX+a))throw`Unable to save file "${a}"`;return this._storage.indexes.push(a),this.SAVE_CONFIG_AFTER_ACTION&&this._saveConfig(),this},deleteFile(a){if(!this._checkTypes([a],["string"]))throw`Invalid input variables`;let b=this._storage.indexes.indexOf(a);if(-1===b)throw`File with name "${a}" isn't exists`;if(localStorage.removeItem(this.STORAGE_PREFIX+a),this.CHECK_FILE_AFTER_ACTION&&null!==localStorage.getItem(this.STORAGE_PREFIX+a))throw`Unable to delete file "${a}"`;return this._storage.indexes.splice(b,1),this.SAVE_CONFIG_AFTER_ACTION&&this._saveConfig(),this},get(a){if(!this._checkTypes([a],["string"]))throw`Invalid input variables`;if(-1===this._storage.indexes.indexOf(a))throw`File with name "${a}" isn't exists`;return localStorage.getItem(this.STORAGE_PREFIX+a)},embed(a,b){if(!this._checkTypes([a,b],["string","string"]))throw`Invalid input variables`;if(-1===this._storage.indexes.indexOf(a))throw`File with name "${a}" isn't exists`;let c,d,e=localStorage.getItem(this.STORAGE_PREFIX+a);switch(b){case"script":return c=new Blob([e],{type:"text/javascript"}),d=document.createElement("script"),d.src=URL.createObjectURL(c),document.getElementsByTagName("head")[0].appendChild(d);case"style":return c=new Blob([e],{type:"text/css"}),d=document.createElement("link"),d.href=URL.createObjectURL(c),d.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(d);case"html":default:this._onload.push(()=>{document.getElementsByTagName("body")[0].innerHTML+=e});}},build(a,b=!0){let c="",d="",e="";if(a.forEach(a=>{let b;try{b=this.get(a.name)}catch(a){throw"Unable to build sources"}switch(a.type){case"script":c+=`${b};\n`;break;case"style":d+=b.split(/\n/).join("");break;default:case"html":e+=b.split(/\n/).join("");}}),""!=c){let a=new Blob([b?`(function(){${c}})()`:c],{type:"text/javascript"}),d=document.createElement("script");d.src=URL.createObjectURL(a),d.type="text/javascript",this.domQuery.add(()=>document.getElementsByTagName("head")[0].appendChild(d))}if(""!==d){let a=new Blob([d],{type:"text/css"}),b=document.createElement("link");b.href=URL.createObjectURL(a),b.rel="stylesheet",this.domQuery.add(()=>document.getElementsByTagName("head")[0].appendChild(b))}""!==e&&this.domQuery.add(()=>{document.getElementsByTagName("body")[0].innerHTML+=e})},domQuery:{loaded:!1,init(){return"loading"===document.readyState?void document.addEventListener("DOMContentLoaded",()=>{this._handlers.forEach(a=>a()),this.loaded=!0}):this.loaded=!0},_handlers:[],add(a){if("function"!=typeof a)throw"Handler must be a function";return this.loaded&&a(),this._handlers.push(a),this}},isExists:a=>-1!==storage._storage.indexes.indexOf(a),repairIndexes(a="delete"){if(!this._checkTypes([a],["string"]))throw`Invalid input variables`;let b=this._checkIndexes();if(this._storage.forEach((c,d)=>{if(!b[d])switch(a){case"create":localStorage.setItem(this.STORAGE_PREFIX+c[0],"");break;case"delete":default:this._storage.indexes.splice(c[1],1);}}),this._checkIndexes().length===this._storage.indexes.length)return this._saveConfig(),!0;throw`Unable to recovery, changes ain't saved`},_saveConfig(){localStorage.setItem("storageConfig",JSON.stringify(this._storage))},_checkTypes(a,b){if("object"!=typeof a||"object"!=typeof b||a.length!==b.length)throw`Invalid construction`;return a.filter((a,c)=>{if(typeof a===b[c])return a}).length===a.length},_init(){let a=localStorage.getItem("storageConfig");null===a&&(a=JSON.stringify({version:1,indexes:[]}),localStorage.setItem("storageConfig",a)),this.domQuery.init(),this._storage=JSON.parse(a)},_checkIndexes(){return this._storage.indexes.map(a=>null!==localStorage.getItem(this.STORAGE_PREFIX+a))},_storage:void 0},storage._init()})();