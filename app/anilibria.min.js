(function(){window.Anilibria=function(a,b){"string"==typeof a&&"string"==typeof b&&this._request("",{url:"https://pur.fle.su/anilibria.php",method:"post",post:!0,data:{mail:a,passwd:b}}).then(a=>{a=JSON.parse(a),"ok"===a[1].err&&(this.session=a[0])}),Object.keys(this._allowedKeys).forEach(a=>{this[a]=function(b={}){return Object.keys(b).forEach(c=>{if(!(c in this._allowedKeys[a]))throw`Invalid key ${c} in ${a}`;if(typeof b[c]!==this._allowedKeys[a][c])throw`Invalid type of ${c}(${typeof b[c]}) in ${a}`}),this._request(a,{method:this._methods[a]||"get",data:{...b,...(void 0===this.session?{}:{session:this.session})}})}})},window.Anilibria.prototype={POOL:"https://api.anilibria.tv/v2/",PROXY:"https://pur.fle.su/ref/post.php?url=",_request(a,b){let c=(b.method||"get").toUpperCase(),d=this._httpBuildQuery(b.data||{});return new Promise((e,f)=>{let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(g.readyState===XMLHttpRequest.DONE)return e(JSON.parse(g.responseText))},g.onerror=()=>f(g),g.open(c,(b.proxy?this.PROXY:"")+(b.url||this.POOL+a)+(b.post?"":"?"+d),b.async||!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(b.data?d:null)})},_httpBuildQuery(a){let b=Object.keys(a).map(b=>`${b}=${"object"==typeof a[b]?Object.values(a[b]).join(","):a[b].toString()}`);return b.join("&")},_allowedKeys:{getTitle:{id:"number",code:"string",torrent_id:"number",filter:"object",remove:"object",include:"object",description_type:"string",playlist_type:"string"},getTitles:{id_list:"object",code_list:"object",filter:"object",remove:"object",include:"object",description_type:"string",playlist_type:"string"},getUpdates:{filter:"object",remove:"object",include:"object",limit:"number",since:"number",description_type:"string",playlist_type:"string",after:"number"},getChanges:{filter:"object",remove:"object",include:"object",limit:"number",since:"number",description_type:"string",after:"number"},getSchedule:{filter:"object",remove:"object",include:"object",days:"object",description_type:"string",playlist_type:"string"},getRandomTitle:{filter:"object",remove:"object",include:"object",description_type:"string",playlist_type:"string"},getYouTube:{filter:"object",remove:"object",limit:"number",since:"number",after:"number"},getFeed:this.getUpdates,getYears:{},getGenres:{sorting_type:"number"},getCachingNodes:{},getTeam:{},getSeedStats:{users:"object",filter:"object",remove:"object",limit:"number",after:"number",sort_by:"string",order:"number"},getRSS:{rss_type:"string",session:"string",limit:"number",since:"number",after:"number"},searchTitles:{search:"string",year:"object",season_code:"object",genres:"object",voice:"object",translator:"object",editing:"object",decor:"object",timing:"object",filter:"object",remove:"object",include:"object",description_type:"string",playlist_type:"string",limit:"number",after:"number"},advancedSearch:{query:"string",filter:"object",remove:"object",include:"object",description_type:"string",playlist_type:"string",limit:"number",after:"number",order_by:"string",sort_direction:"number"},getFavorites:{filter:"object",remove:"object",include:"object",description_type:"string",playlist_type:"string"},addFavorite:{title_id:"number"},delFavorite:this.addFavorite},_methods:{addFavorite:"put",delFavorite:"delete"}}})();