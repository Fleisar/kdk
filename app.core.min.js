(function(){window.App={DEFAULT_MANIFEST:"app.json",info:!1,install(a,b=!1){let c=new Date().getTime();this._downloadManifest(a||this.DEFAULT_MANIFEST,a=>{if(!this._checkTypes([a.name,a.update.release,a.sources],["string","number","object"]))throw`Invalid manifest`;this.uninstall(),App.info=a;let d=0;App.info.logo&&document.querySelector("#app-ui>.loadScreen img").setAttribute("src",App.info.logo),App.info.name&&(document.querySelector("#app-ui>.loadScreen h1").innerHTML=App.info.name),App.info.sources.forEach((a,e)=>{fetch(a.url).then(a=>{if(a.ok){let f=new Date().getTime();a.text().then(a=>{storage.createFile((f.toString()+e.toString()).toString(),a),App.info.sources[e].name=f.toString()+e.toString(),d++,d===App.info.sources.length&&(this._saveConfig(),b?window.location.reload():this.run(!0),App.info.dev_mode&&console.info(`App installed and ran for ${new Date().getTime()-c}ms`))})}else throw`App's file cannot be downloaded`})})})},uninstall(){App.info&&App.info.sources.forEach(a=>storage.deleteFile(a.name.toString()))},run(install=!1){storage.build(App.info.sources);let dom=()=>{if(App.info.application.name!==void 0){let a=document.createElement("meta");a.name="application-name",a.content=App.info.application.name,document.getElementsByTagName("head")[0].appendChild(a)}if(void 0!==App.info.application.manifest){let a=document.createElement("link");a.rel="manifest",a.href=App.info.application.manifest,document.getElementsByTagName("head")[0].appendChild(a)}App.info.logo&&document.querySelector("#app-ui>.loadScreen img").setAttribute("src",App.info.logo),App.info.name&&(document.querySelector("#app-ui>.loadScreen h1").innerHTML=App.info.name),App.info.icon&&App.icon(App.info.icon[0],App.info.icon[1]||"icon"),App.title(App.info.short_name||App.info.name||"Application"),App.info.timeout?setTimeout(App.loaded,+App.info.timeout):(!App.info.load_type||"default"===App.info.load_type)&&this._load.add(this.loaded)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",dom):dom(),!0===install&&App.info.install&&eval(`${App.info.install}()`),App.info.running&&eval(`${App.info.running}()`)},title(a){return void 0===a?document.querySelector("head>title").innerText:(document.querySelector("head>title").innerText=a.toString(),this)},icon(a,b="icon"){let c=document.querySelector("head>link#icon");return void 0===a?c.getAttribute("href"):(c.setAttribute("href",a),c.setAttribute("rel",b),this)},loaded(){let a=()=>{let a=document.querySelector("#app-ui>.loadScreen");a.classList.contains("fade")||a.classList.add("fade")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()},skipUpdate(){return App.info.update.release=Math.floor(new Date().getTime()/1e3),this},chrome:{sw(){return!("https:"!==window.location.protocol)&&void(navigator.serviceWorker.controller?console.log("[PWA Builder] active service worker found, no need to register"):navigator.serviceWorker.register("sw.js").then(function(a){console.log("Service worker has been registered for scope:"+a.scope)}))}},ui:{updateDialog(a){let b=document.querySelectorAll("#app-ui>.window.updateRequest>span>a");b[0].innerText=`${App.info.update.version} (${App.info.update.release})`,b[1].innerText=`${a.update.version} (${a.update.release})`,document.querySelector("#app-ui>.window.updateRequest>h3>a.name").innerText=App.info.name,document.querySelector("#app-ui>.window.updateRequest>p").innerHTML=a.update.description,this.window.open("updateRequest")},window:{current:null,open(a){return null!==this.current&&this.close(),document.querySelector("#app-ui>.window."+a).style.display="block",(this.current=a,this)},close(){return document.querySelector("#app-ui>.window."+this.current).style.display="none",this.current=null,this}}},checkUpdate(a){this._checkUpdate(a||this.DEFAULT_MANIFEST,(a,b)=>{b||this.ui.updateDialog(a)})},_checkUpdate(a,b){this._downloadManifest(a||this.DEFAULT_MANIFEST,a=>{b(a,"release"!==a.update.type||a.update.release<=App.info.update.release)})},_load:{state:!1,init(){return"complete"===document.readyState?(this.state=!0,0<this.query.length&&this.query.forEach(a=>a())):void document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&0<this.query.length&&this.query.forEach(a=>a()),this.state=!0})},query:[],add(a){if("function"!=typeof a)throw"Handler must be a function";return this.state||"complete"===document.readyState?(a(),this):(this.query.push(a),this)}},_init(){let a=localStorage.getItem("Application");null!==a&&(this._load.init(),App.info=JSON.parse(a),App.info.dev_mode?this.install():this.run(),App.info.update_policy.auto&&this.checkUpdate(this.DEFAULT_MANIFEST))},_saveConfig(){localStorage.setItem("Application",JSON.stringify(App.info))},_downloadManifest(a,b){if(!this._checkTypes([a,b],["string","function"]))throw`Invalid input variables`;fetch(a+"?"+new Date().getTime()).then(a=>{if(a.ok)a.json().then(a=>b(a));else throw`Unable to download manifest`})},_checkTypes(a,b){if("object"!=typeof a||"object"!=typeof b||a.length!==b.length)throw`Invalid construction`;return a.filter((a,c)=>{if(typeof a===b[c])return!0}).length===a.length}},App._init()})();